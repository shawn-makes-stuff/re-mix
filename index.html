<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>(re)Mix</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/shawn-makes-stuff/re-mix/refs/heads/main/favicon.ico">
  <!-- Google Material Symbols -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <!-- Left toolbar -->
  <div id="leftToolbar">
    <button id="menuButton" class="icon-btn small-icon" title="Menu">
      <span class="material-symbols-outlined">menu</span>
    </button>
    <button id="undoButton" class="icon-btn small-icon" title="Undo">
      <span class="material-symbols-outlined">undo</span>
    </button>
    <button id="deleteButton" class="icon-btn small-icon" title="Delete selected">
      <span class="material-symbols-outlined">delete</span>
    </button>
    <button id="helpButton" class="icon-btn small-icon" title="Help">
      <span class="material-symbols-outlined">help</span>
    </button>
    <button id="advancedModeButton" class="icon-btn small-icon" title="Advanced mode">
      <span class="material-symbols-outlined">tune</span>
    </button>
  </div>

  <!-- Bottom controls: basic vs advanced -->
  <div id="bottomControls">
    <div id="movementControls" class="controls-card">
      <div class="controls-header">
        <span class="controls-title">Position</span>
        <label class="grid-toggle" for="gridSnapToggle">
          <input type="checkbox" id="gridSnapToggle" checked>
          <span>Snap to grid (25&nbsp;mm)</span>
        </label>
      </div>
      <div class="slider-grid">
        <label class="slider-field">
          <span>X</span>
          <input id="posXSlider" type="range" min="-500" max="500" step="0.5">
          <span id="posXValue" class="slider-value">0&nbsp;mm</span>
        </label>
        <label class="slider-field">
          <span>Y</span>
          <input id="posYSlider" type="range" min="0" max="200" step="0.5">
          <span id="posYValue" class="slider-value">0&nbsp;mm</span>
        </label>
        <label class="slider-field">
          <span>Z</span>
          <input id="posZSlider" type="range" min="-500" max="500" step="0.5">
          <span id="posZValue" class="slider-value">0&nbsp;mm</span>
        </label>
      </div>
      <div class="rotation-row">
        <label class="slider-field">
          <span>Rotation</span>
          <input id="rotYSlider" type="range" min="0" max="360" step="0.5">
          <span id="rotYValue" class="slider-value">0°</span>
        </label>
        <div class="rotation-buttons">
          <button id="rotateLeftBtn" class="icon-btn" title="Rotate -90°">
            <span class="material-symbols-outlined">rotate_left</span>
          </button>
          <button id="rotateRightBtn" class="icon-btn" title="Rotate +90°">
            <span class="material-symbols-outlined">rotate_right</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Sidebar -->
  <aside id="sidebar">
    <!-- Horizontal resize handle -->
    <div id="sidebarResizeHandle"></div>

    <div id="sidebarHeader">
      <div class="toolbar-row">
        <button id="importBtn" class="btn-primary btn-pill">Import Parts</button>
        <button id="exportStlBtn" class="btn-pill">Export STL</button>
      </div>
      <div class="toolbar-row compact">
        <span id="fileName">No file loaded</span>
      </div>
    </div>

    <div id="partsList">
      <div class="parts-header-row">
        <span class="section-label">Parts</span>
        <span>Drag or tap to add</span>
      </div>
      <!-- items injected here -->
    </div>

    <!-- Scene Objects panel (advanced mode only) -->
    <div id="scenePanel" class="sidebar-panel">
      <div id="sceneResizeHandle" class="panel-resize-handle"></div>
      <div class="advanced-header">
        <span class="section-label">Scene Objects</span>
      </div>
      <div id="sceneObjectsList" class="scene-objects-list">
        <!-- rows injected here -->
      </div>
    </div>

    <!-- Advanced panel (transform) (advanced mode only) -->
    <div id="advancedPanel" class="sidebar-panel">
      <div id="advancedResizeHandle" class="panel-resize-handle"></div>

      <div class="advanced-header">
        <span class="section-label">Transform</span>
        <span id="advancedSelectionLabel" class="advanced-selection-label">No part selected</span>
      </div>


      <div class="advanced-grid">
        <label class="advanced-field">
          <span>Pos X</span>
          <input id="posXInput" type="number" step="0.1">
        </label>
        <label class="advanced-field">
          <span>Pos Y</span>
          <input id="posYInput" type="number" step="0.1">
        </label>
        <label class="advanced-field">
          <span>Pos Z</span>
          <input id="posZInput" type="number" step="0.1">
        </label>

        <label class="advanced-field">
          <span>Rot Y (°)</span>
          <input id="rotYInput" type="number" step="5">
        </label>
        <label class="advanced-field">
          <span>Scale X</span>
          <input id="scaleXInput" type="number" step="0.1">
        </label>
        <label class="advanced-field">
          <span>Scale Y</span>
          <input id="scaleYInput" type="number" step="0.1">
        </label>
        <label class="advanced-field">
          <span>Scale Z</span>
          <input id="scaleZInput" type="number" step="0.1">
        </label>
      </div>

    </div>
  </aside>

  <!-- Help overlay -->
  <div id="helpOverlay">
    <div id="helpPanel">
      <div class="help-header">
        <h2>Help & Controls</h2>
        <button id="helpCloseBtn" aria-label="Close help">✕</button>
      </div>
      <div class="help-content">
        <div class="help-section-title">Mouse</div>
        <div class="help-grid">
          <div class="help-key">LMB</div>
          <div class="help-desc">Rotate camera (drag)</div>
          <div class="help-key">RMB</div>
          <div class="help-desc">Pan camera</div>
          <div class="help-key">Wheel</div>
          <div class="help-desc">Zoom in / out</div>
        </div>

        <div class="help-section-title">Selection & Parts</div>
        <div class="help-grid">
          <div class="help-key">Click (viewport)</div>
          <div class="help-desc">Select a single part in the scene</div>
          <div class="help-key">Shift+Click</div>
          <div class="help-desc">Add/remove from selection</div>
        </div>

        <div class="help-section-title">Modes</div>
        <div class="help-grid">
          <div class="help-key">
            <span class="material-symbols-outlined" style="font-size:12px;vertical-align:middle;">tune</span>
          </div>
          <div class="help-desc">
            Toggle Advanced editing mode
          </div>
        </div>

        <div class="help-section-title">Placement</div>
        <div class="help-grid">
          <div class="help-key">Bottom sliders</div>
          <div class="help-desc">Adjust X/Y/Z position and rotation like a game HUD</div>
          <div class="help-key">Snap toggle</div>
          <div class="help-desc">Lock placement to the 25&nbsp;mm grid</div>
          <div class="help-key">Q</div>
          <div class="help-desc">Rotate selected -90°</div>
          <div class="help-key">E</div>
          <div class="help-desc">Rotate selected +90°</div>
          <div class="help-key">Shift+Q / Shift+E</div>
          <div class="help-desc">Rotate selected in 15° steps</div>
        </div>

        <div class="help-section-title">Advanced editing</div>
        <div class="help-grid">
          <div class="help-key">Sidebar panel</div>
          <div class="help-desc">Type exact position, rotation, and scale values</div>
        </div>

        <div class="help-section-title">Editing</div>
        <div class="help-grid">
          <div class="help-key">Del / Backspace</div>
          <div class="help-desc">Delete selected parts</div>
          <div class="help-key">Ctrl+Z</div>
          <div class="help-desc">Undo</div>
          <div class="help-key">Ctrl+Y</div>
          <div class="help-desc">Redo</div>
        </div>

        <div class="help-section-title">View</div>
        <div class="help-grid">
          <div class="help-key">H / Home</div>
          <div class="help-desc">Re-center view on layout</div>
        </div>

        <div class="help-section-title">Files</div>
        <div class="help-grid">
          <div class="help-key">Import Parts</div>
          <div class="help-desc">Load a multi-part FBX library</div>
          <div class="help-key">Export STL</div>
          <div class="help-desc">Export the current layout as STL</div>
        </div>
      </div>

    </div>
    </div>
  </div>

  <!-- Main view -->
  <div id="viewer"></div>
  <input type="file" id="fileInput" accept=".fbx" style="display:none" />

  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.165.0/build/three.module.js"
    }
  }
  </script>

  <script type="module" src="javascript.js"></script>
</body>

</html>

